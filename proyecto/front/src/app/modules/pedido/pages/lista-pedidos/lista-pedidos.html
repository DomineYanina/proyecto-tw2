<p-toast />
<p-table 
    [value]="pedidos" 
    dataKey="id" 
    [tableStyle]="{ 'min-width': '60rem' }" 
    [expandedRowKeys]="expandedRows" 
    (onRowExpand)="onRowExpand($event)" 
    (onRowCollapse)="onRowCollapse($event)"
>
    <ng-template #caption>
        <div class="flex flex-wrap justify-end gap-2">
            <p-button label="Mostrar Todo" icon="pi pi-plus" text (onClick)="expandAll()" />
            <p-button label="Esconder Todo" icon="pi pi-minus" text (onClick)="collapseAll()" />
        </div>
    </ng-template>
    <ng-template #header>
        <tr>
            <th style="width: 5rem"></th> 
            <th>ID Pedido</th> 
            <th>Fecha Compra</th>
            <th>Total</th>
            <th>Estado</th>
        </tr>
    </ng-template>
    
    <ng-template #body let-pedido let-expanded="expanded">
        <tr>
            <td>
                <p-button type="button" pRipple [pRowToggler]="pedido" [text]="true" severity="secondary" [rounded]="true" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
            </td>
            <td>{{ pedido.id }}</td>
            <td>{{ pedido.fecha_creacion | date: 'dd/MM/yyyy' }}</td>
            <td>{{ pedido.total | currency : 'USD' : 'symbol' : '1.2-2' }}</td>
            <td>
                <p-tag [value]="pedido.estado" />
            </td>
        </tr>
    </ng-template>
    
    <ng-template #expandedrow let-pedido>
        <tr>
            <td colspan="5"> 
                <div class="p-4">
                    <h5>Videojuegos en el Pedido #{{ pedido.id }}</h5>
                    
                    <p-table [value]="pedido.videojuegos" dataKey="videojuego_id">
                        <ng-template #header>
                            <tr>
                                <th>Nombre</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                            </tr>
                        </ng-template>
                        <ng-template #body let-item>
                            <tr>
                                <td>{{ item.videojuego?.nombre }}</td> 
                                <td>{{ item.cantidad }}</td>
                                <td>{{ item.videojuego?.precio | currency : 'USD' : 'symbol' : '1.2-2' }}</td>
                            </tr>
                        </ng-template>
                        <ng-template #emptymessage>
                            <tr>
                                <td colspan="3">No hay videojuegos en este pedido.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>